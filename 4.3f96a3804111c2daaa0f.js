webpackJsonp([4],{2306:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2421),r=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=r.default},2314:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CountryDataContext=void 0;var r=a(0),u=n(r),i=a(1),o=n(i),l=t.CountryDataContext=(0,r.createContext)([]),s=function(e){var t=e.data,a=e.hasSitesWithTrackingData,n=e.studyId,r=e.scenarioId,i=e.countryId,o=e.children,s=t.find(function(e){return"country"===e.type&&e.platform_country_id===i}),c={countryPlannedData:s,hasSitesWithTrackingData:a,studyId:n,scenarioId:r,countryId:i};return u.default.createElement(l.Provider,{value:c},o)};s.defaultProps={data:[],hasSitesWithTrackingData:!1},s.propTypes={data:o.default.array,hasSitesWithTrackingData:o.default.bool,studyId:o.default.number.isRequired,scenarioId:o.default.number.isRequired,countryId:o.default.number.isRequired,children:o.default.node.isRequired},t.default=s},2331:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCountrySitesManagers=void 0;var n=a(12),r=function(e){return e&&e.__esModule?e:{default:e}}(n),u=a(47),i=a(63),o=function(e,t){var a=(0,r.default)(e,"countryNotes."+[t.scenarioId]+"."+[t.countryId],[]);return a?a.length:0};t.getCountrySitesManagers=(0,u.createSelector)([i.getRouteParams,function(e){return e.sites.countrySitesManager}],function(e,t){return t[e.countryId]}),t.default=o},2388:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(12),r=function(e){return e&&e.__esModule?e:{default:e}}(n),u=a(47),i=a(63),o=[],l=(0,u.createSelector)([i.getRouteParams,function(e){return e.countryNotes}],function(e,t){return(0,r.default)(t,[e.scenarioId]+"."+[e.countryId],o)});t.default=l},2389:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(0),u=n(r),i=a(1),o=n(i),l=a(7),s=a(2),c=n(s),d=a(75),f=n(d),m=a(6),p=a(753),y=n(p),h=a(754),g=n(h),S=a(34),v=a(28),E=n(v),b=a(2388),I=n(b),_=a(230);a(2476);var C=function(e){var t=e.open,a=e.onClose,n=(0,l.useDispatch)(),r=(0,E.default)(),i=r.match.params,o=i.scenarioId,s=i.countryId,d=(0,l.useSelector)(function(e){return(0,I.default)(e,r)});return u.default.createElement("div",{className:(0,c.default)("sites-notes-panel",{open:t})},u.default.createElement("div",{className:"fpo-scenario-notes__close-container"},u.default.createElement("div",{onClick:a,className:"fpo-scenario-notes__close-button"},m.Icons.CROSS)),u.default.createElement("div",{className:"fpo-scenario-notes__content"},u.default.createElement(f.default,{style:{maxHeight:"calc(100vh - 100px)"},horizontal:!1,stopScrollPropagation:!0},u.default.createElement("div",{className:"fpo-scenario-notes__scrollable-wrapper"},u.default.createElement("div",{className:"fpo-scenario-notes__title-wrapper"},u.default.createElement("div",{className:"font-black"},"Notes"),u.default.createElement("div",{className:"fpo-scenario-notes__counter"},u.default.createElement("div",{className:"fpo-scenario-notes__counter-value"},d.length>0?(0,S.kFormatter)(d.length):""),u.default.createElement("div",{className:"fpo-scenario-notes__counter-icon"},m.Icons.NOTES))),u.default.createElement(y.default,{scenarioId:+o,onSubmit:function(e,t){return n((0,_.addCountrySitesNote)(e,s,t))}}),u.default.createElement(g.default,{notesData:d})))))};C.propTypes={open:o.default.bool.isRequired,onClose:o.default.func.isRequired},t.default=u.default.memo(C)},2420:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var a=[],n=!0,r=!1,u=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,u=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw u}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=a(0),i=n(u),o=a(16),l=a(7),s=a(19),c=a(12),d=n(c),f=a(107),m=a(6),p=a(2389),y=n(p),h=a(2331),g=n(h),S=a(749),v=a(752),E=a(751),b=a(34),I=a(28),_=n(I),C=a(310),D=function(){var e=(0,l.useDispatch)(),t=(0,_.default)(),a=(0,o.useLocation)(),n=t.match.params,c=n.id,p=n.scenarioId,h=n.countryId,I=["/site/"],D=I.filter(function(e){return-1!==a.pathname.indexOf(e)}).length>0,N=(0,u.useState)(!1),R=r(N,2),k=R[0],O=R[1],w=(0,u.useCallback)(function(){return O(!1)},[O]),T=(0,l.useSelector)(function(e){return(0,g.default)(e,{scenarioId:p,countryId:h})}),P=(0,l.useSelector)(function(e){return(0,d.default)(e,"sites.past",[]).length}),A=(0,l.useSelector)(function(e){return(0,d.default)(e,"sites.future",[]).length}),x=(0,l.useSelector)(function(e){return(0,d.default)(e,"sites.hasChanges")}),M=(0,l.useSelector)(function(e){return(0,d.default)(e,"sites.loadingSites")}),j=(0,l.useSelector)(function(e){return(0,S.getSelectedSitesCount)(e,t)}),q=(0,l.useSelector)(function(e){return(0,v.getOtherSitesCount)(e,t)}),F=(0,l.useSelector)(function(e){return(0,E.getExternalSitesCount)(e,t)}),W=(0,u.useCallback)(function(){e((0,C.undoSiteAction)(p))},[e,p]),V=(0,u.useCallback)(function(){e((0,C.redoSiteAction)(p))},[e,p]),U=(0,u.useCallback)(function(){e((0,C.updateSites)(c,p,h))},[e,c,p,h]),H=(0,u.useCallback)(function(){e((0,C.exportCountrySitesSelection)(c,p,h))},[e,c,p,h]);return i.default.createElement(i.default.Fragment,null,i.default.createElement(f.Sidebar,null,i.default.createElement(f.Button,{height:60,onClick:function(){e(D?(0,s.push)("/studies/"+c+"/scenarios/"+p+"/sites/"+h):(0,s.push)("/studies/"+c+"/scenarios/"+p))}},m.Icons.CHEVRON_LEFT),i.default.createElement(f.Separator,{height:20}),i.default.createElement(f.Button,{height:56,onClick:function(){return O(!k)},tooltip:"Notes"},i.default.createElement("div",{style:{position:"relative",display:"flex",alignItems:"center",width:"100%"}},m.Icons.NOTES,i.default.createElement("div",{className:"sup"},T>0?(0,b.kFormatter)(T):""))),i.default.createElement(f.Button,{className:"fpo-exit-button",height:56,disabled:!P,onClick:W},i.default.createElement(f.AnimatedContent,{tooltip:"Undo",disabled:!P},m.Icons.UNDO)),i.default.createElement(f.Button,{className:"fpo-exit-button flip-vertical",height:56,disabled:!A,onClick:V},i.default.createElement(f.AnimatedContent,{tooltip:"Redo",disabled:!A},m.Icons.UNDO)),i.default.createElement(f.Button,{height:56,tooltip:"Save",disabled:!x,onClick:U},m.Icons.SAVE),i.default.createElement(f.Button,{height:56,tooltip:x?"You have unsaved changes, please save in order to export site list":"Export to Excel",disabled:M||0===j&&0===q&&0===F||x,onClick:H},m.Icons.DOWNLOAD)),i.default.createElement(y.default,{open:k,onClose:w,countryId:h}))};t.default=D},2421:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},u=function(){function e(e,t){var a=[],n=!0,r=!1,u=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,u=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw u}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=a(0),o=n(i),l=a(1),s=n(l),c=a(7),d=a(19),f=a(16),m=a(12),p=n(m),y=a(2),h=n(y),g=a(6),S=a(83),v=n(S),E=a(17),b=a(232),I=n(b),_=a(193),C=n(_),D=a(755),N=n(D),R=a(165),k=n(R),O=a(44),w=a(2314),T=n(w),P=a(452),A=n(P),x=a(192),M=n(x),j=a(2420),q=n(j),F=a(53),W=a(63),V=a(311),U=a(35),H=a(28),L=a(230),B=a(33),G=a(310),Y=n(G),z=a(10),J=n(z);a(2483);var K={name:J.default,type:z.ROLLUP,subject:null},Q=function(e){var t=e.studyId,a=e.scenarioId,n=e.countryId,l=e.navigate,s=e.children,d=e.platformRegions,f=e.getScenario,m=e.studyName,p=e.scenarioName,y=e.fullData,S=e.hasChanges,b=e.resetSitesData,_=e.getEditableSitesCountries,D=e.onSiteDetailsPage,R=e.countryName,w=e.siteName,P=e.dirtyDataFor,x=e.hasSiteData,j=e.getSites,F=e.hasScenarioData,W=e.getSiteEditReasons,V=e.hasSitesWithTrackingData,H=e.tableView,B=e.toggleTableView,G=e.sitesDataAvailable,Y=(0,c.useDispatch)(),z=(0,i.useState)(!1),J=u(z,2),Q=J[0],X=J[1],Z=(0,i.useState)(function(){if(y&&y.length){var e=y.find(function(e){return e.platform_country_id===+n});if(e)return{name:e.country_name,type:"COUNTRY",subject:e.region_name}}return null}),$=u(Z,2),ee=$[0],te=$[1];(0,i.useEffect)(function(){if(!ee&&y&&y.length){var e=y.find(function(e){return e.platform_country_id===+n});e&&te({name:e.country_name,type:"COUNTRY",subject:e.region_name})}},[y,ee,n]),(0,i.useEffect)(function(){W()},[W]);var ae=(0,i.useCallback)(function(e){var n=void 0;if("REGION"===e.type){var u=y.filter(function(t){return t.region_name===e.name&&"country"===t.type}),i=u[0];n=i.platform_country_id,te({name:i.country_name,type:"COUNTRY",subject:i.region_name})}else if("COUNTRY"===e.type){var o=y.find(function(t){return t.country_name===e.name});n=o.platform_country_id,te(r({},e))}else{var s=y.filter(function(e){return"country"===e.type}),c=s[0];n=c.platform_country_id,te({name:c.country_name,type:"COUNTRY",subject:c.region_name})}l("/studies/"+t+"/scenarios/"+a+"/sites/"+n)},[y,t,a,l]);return(0,i.useEffect)(function(){F||f(t,a)},[f,t,a,F]),(0,i.useEffect)(function(){return function(){(0,U.resetState)("fpo-sites-state"),b(a)}},[b,a]),(0,i.useEffect)(function(){_(t,a)},[t,a,_]),(0,i.useEffect)(function(){S?P&&P.scenarioId===a&&P.countryId.includes(n)?X(!0):((0,U.resetState)("fpo-sites-state"),b(a)):!S&&P&&P.scenarioId===a&&((0,U.resetState)("fpo-sites-state"),b(a))},[]),(0,i.useEffect)(function(){x||(j(t,a,n),Y((0,L.getCountryNotes)(a,n)))},[j,t,a,n,x,Y]),(0,i.useEffect)(function(){V||"CURRENT"!==H||B("HISTORICAL")},[V,H,B]),o.default.createElement("div",{className:"sites-container"},o.default.createElement(q.default,null),o.default.createElement(E.Grid,null,o.default.createElement(E.Row,null,o.default.createElement(E.Col,{offset:1,width:10},o.default.createElement("h3",{className:"study-scenario-name"},o.default.createElement("span",{className:"breadcrumb-link",onClick:function(){return l("/studies/"+t)}},D?"...":m),o.default.createElement("span",{className:"arrow-separator"},g.Icons.ARROW_RIGHT),o.default.createElement("span",{className:"breadcrumb-link",onClick:function(){return l("/studies/"+t+"/scenarios/"+a)}},p),o.default.createElement("span",{className:"arrow-separator"},g.Icons.ARROW_RIGHT),o.default.createElement("span",{className:(0,h.default)({"breadcrumb-link":D}),onClick:function(){D&&l("/studies/"+t+"/scenarios/"+a+"/sites/"+n)}},D?"Sites | "+R:"Sites"),D&&o.default.createElement(o.default.Fragment,null,o.default.createElement("span",{className:"arrow-separator"},g.Icons.ARROW_RIGHT),o.default.createElement("span",null,w||"n/a")),!G&&o.default.createElement(M.default,{placement:"top",mouseEnterDelay:.3,overlay:o.default.createElement("div",null,"Sorry, site functionality is not fully available ",o.default.createElement("br",null),"because of data update running at the moment.",o.default.createElement("br",null),"Please try again in a few minutes")},o.default.createElement("div",{className:"sites-health-icon"},g.Icons.WARNING)))),o.default.createElement(E.Col,{width:1},o.default.createElement("h3",null,o.default.createElement(N.default,{studyId:t,scenarioId:a}))))),!D&&o.default.createElement(v.default,{style:{top:0,zIndex:4,backgroundColor:"white"}},o.default.createElement(E.Grid,null,o.default.createElement(E.Row,null,o.default.createElement(E.Col,{offset:1,width:11},o.default.createElement(A.default,null,o.default.createElement(I.default,{hideAllCountries:!0,activeFilter:ee||K,data:y,platformRegions:d,onFilterSelect:ae})))))),o.default.createElement(A.default,null,o.default.createElement(T.default,{data:y,hasSitesWithTrackingData:V,studyId:t,scenarioId:a,countryId:n},s)),o.default.createElement(C.default,{allowTabs:!0,tabsCommonPath:"/sites",hasUnsaved:S}),o.default.createElement(k.default,{isShown:Q,onSubmit:function(){return X(!1)},onClose:function(){(0,U.resetState)("fpo-sites-state"),b(a),X(!1)}}),o.default.createElement(O.ContextHelpButton,{page:"site-list"}))},X=function(e,t){var a=(0,f.matchPath)(e.router.location.pathname,{path:"/studies/:id/scenarios/:scenarioId/sites/:countryId/site/:siteId"}),n=a?a.params:t.match.params,r=n.scenarioId,u=n.id,i=n.countryId,o=n.siteId,l=(0,H.getRouteMatch)(a?{match:a}:t),s=(0,W.getStudyData)(e,l),c=(0,F.getScenarioData)(e,l),d=(0,F.getActiveCountry)(e,l),m=!!e.sites[r]&&!!e.sites[r][i]&&void 0!==e.sites.dirtyDataFor&&null!==e.sites.dirtyDataFor&&e.sites.dirtyDataFor.scenarioId===+r&&e.sites.dirtyDataFor.countryId.includes(+i),y=["/site/"],h=y.filter(function(e){return-1!==t.location.pathname.indexOf(e)}).length>0,g=(0,p.default)(e,"site["+o+"].siteData",{});return{siteName:((0,p.default)(g,"PI.name","")||"n/a")+" | "+((0,p.default)(g,"name","")||"n/a"),countryName:d?d.country_name:"",onSiteDetailsPage:h,hasSiteData:m,studyName:(0,p.default)(s,"study_id",""),scenarioName:(0,p.default)(c,"name",""),studyId:+u,scenarioId:+r,countryId:+i,dirtyDataFor:e.sites.dirtyDataFor,fullData:(0,F.getScenarioFullData)(e,l),platformRegions:(0,F.getPlatformRegionsList)(e,l),hasScenarioData:!!c,hasSitesWithTrackingData:(0,V.hasTrackingData)(e,l),tableView:e.sites.tableView,sitesDataAvailable:(0,V.getSitesDataAvailability)(e)}},Z={getScenario:B.getScenarioViewerData,resetSitesData:G.resetSites,getEditableSitesCountries:G.getEditableCountries,getSites:Y.default,navigate:d.push,getSiteEditReasons:G.getSiteEditReasonsAction,toggleTableView:G.toggleTableViewMode};Q.defaultProps={platformRegions:[],studyName:"",scenarioName:"",fullData:[],hasChanges:!1,undoStack:0,redoStack:0,onSiteDetailsPage:!1,countryName:"",siteName:"",dirtyDataFor:{},hasSiteData:!1,hasScenarioData:!1,hasSitesWithTrackingData:!1,tableView:"HISTORICAL",sitesDataAvailable:!0},Q.propTypes={studyId:s.default.number.isRequired,scenarioId:s.default.number.isRequired,countryId:s.default.number.isRequired,navigate:s.default.func.isRequired,children:s.default.node.isRequired,platformRegions:s.default.array,getScenario:s.default.func.isRequired,studyName:s.default.string,scenarioName:s.default.string,fullData:s.default.array,hasChanges:s.default.bool,resetSitesData:s.default.func.isRequired,getEditableSitesCountries:s.default.func.isRequired,onSiteDetailsPage:s.default.bool,countryName:s.default.string,siteName:s.default.string,dirtyDataFor:s.default.object,hasSiteData:s.default.bool,getSites:s.default.func.isRequired,hasScenarioData:s.default.bool,getSiteEditReasons:s.default.func.isRequired,hasSitesWithTrackingData:s.default.bool,tableView:s.default.string,toggleTableView:s.default.func.isRequired,sitesDataAvailable:s.default.bool},t.default=(0,f.withRouter)((0,c.connect)(X,Z)(Q))},2432:function(e,t,a){t=e.exports=a(3)(void 0),t.push([e.i,"",""])},2440:function(e,t,a){t=e.exports=a(3)(void 0),t.push([e.i,"",""])},2476:function(e,t,a){var n=a(2432);"string"==typeof n&&(n=[[e.i,n,""]]);var r={singleton:!0};r.transform=void 0,a(4)(n,r),n.locals&&(e.exports=n.locals)},2483:function(e,t,a){var n=a(2440);"string"==typeof n&&(n=[[e.i,n,""]]);var r={singleton:!0};r.transform=void 0,a(4)(n,r),n.locals&&(e.exports=n.locals)}});